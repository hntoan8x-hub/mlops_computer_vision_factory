# pipeline_config.yaml - Master Blueprint chứa tất cả 21 Component
#
# Cấu trúc:
# 1. cleaning (Các bước tiền xử lý cơ bản, luôn được áp dụng)
# 2. augmentation (Chỉ áp dụng trong context='training')
# 3. feature_engineering (Trích xuất đặc trưng/Embedding/Giảm chiều)

pipeline_name: "Master_CV_Processing_Flow"
version: "1.0"
description: "Cấu hình mẫu bao gồm tất cả các loại Adapter (Core CV và Domain-Specific)."

# --- 1. CORE CLEANING (Tiền xử lý cơ bản) ---
cleaning:
  steps:
    # 1.1. Image Resizer (CV CORE)
    - type: "resizer"
      enabled: true
      params:
        width: 224
        height: 224
        # cv2.INTER_LINEAR (1), cv2.INTER_AREA (2), cv2.INTER_NEAREST (0)
        interpolation: 2

    # 1.2. Color Space Conversion (CV CORE)
    - type: "color_space"
      enabled: true
      params:
        conversion_code: "BGR2RGB" # Chuyển đổi từ OpenCV BGR sang chuẩn RGB

    # 1.3. Normalizer (CV CORE)
    - type: "normalizer"
      enabled: true
      params:
        # Giá trị cho ResNet/ImageNet (3 kênh)
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]

    # 1.4. Depth Cleaner (DOMAIN: DEPTH)
    # NOTE: Chỉ kích hoạt nếu đầu vào là dữ liệu Depth (CVPreprocessingOrchestrator sẽ định tuyến)
    - type: "depth_cleaner"
      enabled: false
      params:
        min_depth: 0.5 # Meters
        max_depth: 10.0
        normalize_depth: true

    # 1.5. Mask Cleaner (DOMAIN: MASK)
    - type: "mask_cleaner"
      enabled: false
      params:
        min_mask_area: 256
        apply_erosion: true

    # 1.6. Point Cloud Cleaner (DOMAIN: POINTCLOUD)
    - type: "pointcloud_cleaner"
      enabled: false
      params:
        method: "voxelize"
        voxel_size: 0.05
        normalize_coords: true

# --- 2. AUGMENTATION (Chỉ áp dụng cho Training Context) ---
augmentation:
  enabled: true
  steps:
    # 2.1. Flip and Rotate (CV CORE) - X-only
    - type: "flip_rotate"
      enabled: true
      params:
        p_flip_h: 0.5
        rotate_limit: 15 # Max 15 degrees

    # 2.2. Noise Injection (CV CORE) - X-only
    - type: "noise_injection"
      enabled: true
      params:
        noise_type: "gaussian"
        strength: 0.05

    # 2.3. Mixup (CV CORE) - X & Y Augmentation
    - type: "mixup"
      enabled: true
      params:
        alpha: 0.2
        p: 0.5 # Áp dụng với xác suất 50%

    # 2.4. CutMix (CV CORE) - X & Y Augmentation
    - type: "cutmix"
      enabled: true
      params:
        alpha: 1.0
        p: 0.3

    # 2.5. Depth Augmenter (DOMAIN: DEPTH)
    - type: "depth_augmenter"
      enabled: false # Tắt trong ví dụ này, kích hoạt cùng lúc với Depth Cleaner
      params:
        p_augment: 0.4
        max_rotation_deg: 5.0

    # 2.6. Mask Augmenter (DOMAIN: MASK)
    - type: "mask_augmenter"
      enabled: false
      params:
        p_augment: 0.5
        preserve_mask_shape: true

    # 2.7. Point Cloud Augmenter (DOMAIN: POINTCLOUD)
    - type: "pointcloud_augmenter"
      enabled: false
      params:
        max_translation: 0.1 # Max 10cm translation
        apply_jitter: true

    # 2.8. Text Augmenter (DOMAIN: TEXT)
    - type: "text_augmenter"
      enabled: true
      params:
        augmentation_method: "synonym"
        augmentation_rate: 0.1

# --- 3. FEATURE ENGINEERING & EMBEDDING (Trích xuất đặc trưng) ---
feature_engineering:
  components:
    # 3.1. CNN Embedder (DL EMBEDDER) - Stateful (Persistence)
    - type: "cnn_embedder"
      enabled: true
      params:
        model_name: "resnet18"
        pretrained: true
        remove_head: true

    # 3.2. ViT Embedder (DL EMBEDDER) - Stateful (Persistence)
    - type: "vit_embedder"
      enabled: false
      params:
        model_name: "google/vit-base-patch16-224"
        pretrained: true

    # 3.3. HOG Extractor (FEATURE EXTRACTOR) - Stateless
    - type: "hog_extractor"
      enabled: false
      params:
        orientations: 9
        pixels_per_cell: [8, 8]

    # 3.4. SIFT Extractor (FEATURE EXTRACTOR) - Stateless
    - type: "sift_extractor"
      enabled: false
      params:
        nfeatures: 1000
        contrastThreshold: 0.04

    # 3.5. ORB Extractor (FEATURE EXTRACTOR) - Stateless
    - type: "orb_extractor"
      enabled: false
      params:
        nfeatures: 500
        scaleFactor: 1.2

    # 3.6. Dimensionality Reducer (FEATURE EXTRACTOR) - Stateful (ML)
    - type: "dim_reducer"
      enabled: false
      params:
        method: "pca"
        n_components: 128

    # 3.7. Text Tokenizer (DOMAIN: TEXT) - Stateful (ML)
    - type: "text_tokenizer"
      enabled: true
      params:
        max_sequence_length: 512
        vocab_size: 30000
        padding_strategy: "post"
